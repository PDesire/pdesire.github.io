(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{285:function(t,e,n){"use strict";n.r(e),n.d(e,"ion_virtual_scroll",(function(){return c}));var r=n(33);const l=(t,e)=>{const template=h(t,e);return template&&t.ownerDocument?t.ownerDocument.importNode(template.content,!0).children[0]:null},h=(t,e)=>{switch(e){case"item":return t.querySelector("template:not([name])");case"header":return t.querySelector("template[name=header]");case"footer":return t.querySelector("template[name=footer]")}},o=(t,e,n,r,l,h,o,c,d,m,f,v)=>{const x=[],H=v+f;for(let i=f;i<H;i++){const f=t[i];if(l){const e=l(f,i,t);null!=e&&x.push({i:m++,type:"header",value:e,index:i,height:n?n(e,i):o,reads:n?0:2,visible:!!n})}if(x.push({i:m++,type:"item",value:f,index:i,height:e?e(f,i):d,reads:e?0:2,visible:!!e}),h){const e=h(f,i,t);null!=e&&x.push({i:m++,type:"footer",value:e,index:i,height:r?r(e,i):c,reads:r?0:2,visible:!!r})}}return x},c=class{constructor(t){Object(r.l)(this,t),this.range={offset:0,length:0},this.viewportHeight=0,this.cells=[],this.virtualDom=[],this.isEnabled=!1,this.viewportOffset=0,this.currentScrollTop=0,this.indexDirty=0,this.lastItemLen=0,this.totalHeight=0,this.approxItemHeight=45,this.approxHeaderHeight=30,this.approxFooterHeight=30,this.onScroll=()=>{this.updateVirtualScroll()}}itemsChanged(){this.calcCells(),this.updateVirtualScroll()}async connectedCallback(){const t=this.el.closest("ion-content");t?(this.scrollEl=await t.getScrollElement(),this.contentEl=t,this.calcCells(),this.updateState()):console.error("<ion-virtual-scroll> must be used inside an <ion-content>")}componentDidUpdate(){this.updateState()}disconnectedCallback(){this.scrollEl=void 0}onResize(){this.calcCells(),this.updateVirtualScroll()}positionForItem(t){return Promise.resolve(((t,e,n)=>{const r=e.find(e=>"item"===e.type&&e.index===t);return r?n[r.i]:-1})(t,this.cells,this.getHeightIndex()))}async checkRange(t,e=-1){if(!this.items)return;const n=-1===e?this.items.length-t:e,r=((t,e)=>{const n=t.length>0?t[t.length-1].index:0;return 0===e?0:e===n+1?t.length:t.findIndex(t=>t.index===e)})(this.cells,t),l=o(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,r,t,n);this.cells=((t,e,n)=>{if(0===n&&e.length>=t.length)return e;for(let i=0;i<e.length;i++)t[i+n]=e[i];return t})(this.cells,l,r),this.lastItemLen=this.items.length,this.indexDirty=Math.max(t-1,0),this.scheduleUpdate()}async checkEnd(){this.items&&this.checkRange(this.lastItemLen)}updateVirtualScroll(){this.isEnabled&&this.scrollEl&&(this.timerUpdate&&(clearTimeout(this.timerUpdate),this.timerUpdate=void 0),Object(r.h)(this.readVS.bind(this)),Object(r.n)(this.writeVS.bind(this)))}readVS(){const{contentEl:t,scrollEl:e,el:n}=this;let r=0,l=n;for(;l&&l!==t;)r+=l.offsetTop,l=l.parentElement;this.viewportOffset=r,e&&(this.viewportHeight=e.offsetHeight,this.currentScrollTop=e.scrollTop)}writeVS(){const t=this.indexDirty,e=((t,e,n)=>({top:Math.max(t-n,0),bottom:t+e+n}))(this.currentScrollTop-this.viewportOffset,this.viewportHeight,100),n=this.getHeightIndex(),h=((t,e,n)=>{const r=e.top,l=e.bottom;let i=0;for(;i<t.length&&!(t[i]>r);i++);const h=Math.max(i-n-1,0);for(;i<t.length&&!(t[i]>=l);i++);return{offset:h,length:Math.min(i+n,t.length)-h}})(n,e,2);((t,e,n)=>t<=n.offset+n.length||e.offset!==n.offset||e.length!==n.length)(t,this.range,h)&&(this.range=h,((t,e,n,r)=>{for(const e of t)e.change=0,e.d=!0;const l=[],h=r.offset+r.length;for(let i=r.offset;i<h;i++){const r=n[i],h=t.find(t=>t.d&&t.cell===r);if(h){const t=e[i];t!==h.top&&(h.top=t,h.change=1),h.d=!1}else l.push(r)}const o=t.filter(t=>t.d);for(const n of l){const r=o.find(t=>t.d&&t.cell.type===n.type),l=n.i;r?(r.d=!1,r.change=2,r.cell=n,r.top=e[l]):t.push({d:!1,cell:n,visible:!0,change:2,top:e[l]})}t.filter(t=>t.d&&-9999!==t.top).forEach(t=>{t.change=1,t.top=-9999})})(this.virtualDom,n,this.cells,h),this.nodeRender?((t,e,n,r)=>{const h=Array.from(t.children).filter(t=>"TEMPLATE"!==t.tagName),o=h.length;let c;for(let i=0;i<n.length;i++){const d=n[i],m=d.cell;if(2===d.change){if(i<o)c=h[i],e(c,m,i);else{const n=l(t,m.type);c=e(n,m,i)||n,c.classList.add("virtual-item"),t.appendChild(c)}c.$ionCell=m}else c=h[i];0!==d.change&&(c.style.transform=`translate3d(0,${d.top}px,0)`);const f=m.visible;d.visible!==f&&(f?c.classList.remove("virtual-loading"):c.classList.add("virtual-loading"),d.visible=f),m.reads>0&&(r(m,c),m.reads--)}})(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this)):this.domRender?this.domRender(this.virtualDom):this.renderItem&&Object(r.k)(this))}updateCellHeight(t,e){const n=()=>{if(e.$ionCell===t){const style=window.getComputedStyle(e),n=e.offsetHeight+parseFloat(style.getPropertyValue("margin-bottom"));this.setCellHeight(t,n)}};e&&e.componentOnReady?e.componentOnReady().then(n):n()}setCellHeight(t,e){const n=t.i;t===this.cells[n]&&(t.height===e&&!0===t.visible||(t.visible=!0,t.height=e,this.indexDirty=Math.min(this.indexDirty,n),this.scheduleUpdate()))}scheduleUpdate(){clearTimeout(this.timerUpdate),this.timerUpdate=setTimeout(()=>this.updateVirtualScroll(),100)}updateState(){const t=!(!this.scrollEl||!this.cells);t!==this.isEnabled&&(this.enableScrollEvents(t),t&&this.updateVirtualScroll())}calcCells(){this.items&&(this.lastItemLen=this.items.length,this.cells=o(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen),this.indexDirty=0)}getHeightIndex(){return this.indexDirty!==1/0&&this.calcHeightIndex(this.indexDirty),this.heightIndex}calcHeightIndex(t=0){this.heightIndex=((t,e)=>{if(!t)return new Uint32Array(e);if(t.length===e)return t;if(e>t.length){const n=new Uint32Array(e);return n.set(t),n}return t.subarray(0,e)})(this.heightIndex,this.cells.length),this.totalHeight=((t,e,n)=>{let r=t[n];for(let i=n;i<t.length;i++)t[i]=r,r+=e[i].height;return r})(this.heightIndex,this.cells,t),this.indexDirty=1/0}enableScrollEvents(t){this.rmEvent&&(this.rmEvent(),this.rmEvent=void 0);const e=this.scrollEl;e&&(this.isEnabled=t,e.addEventListener("scroll",this.onScroll),this.rmEvent=()=>{e.removeEventListener("scroll",this.onScroll)})}renderVirtualNode(t){const{type:e,value:n,index:r}=t.cell;switch(e){case"item":return this.renderItem(n,r);case"header":return this.renderHeader(n,r);case"footer":return this.renderFooter(n,r)}}render(){return Object(r.j)(r.b,{style:{height:this.totalHeight+"px"}},this.renderItem&&Object(r.j)(d,{dom:this.virtualDom},this.virtualDom.map(t=>this.renderVirtualNode(t))))}get el(){return Object(r.g)(this)}static get watchers(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}}},d=({dom:t},e,n)=>n.map(e,(e,i)=>{const n=t[i],r=e.vattrs||{};let l=r.class||"";return l+="virtual-item ",n.visible||(l+="virtual-loading"),Object.assign(Object.assign({},e),{vattrs:Object.assign(Object.assign({},r),{class:l,style:Object.assign(Object.assign({},r.style),{transform:`translate3d(0,${n.top}px,0)`})})})});c.style="ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute !important;top:0 !important;right:0 !important;left:0 !important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}"}}]);